#!/bin/bash

set -e # Errors are fatal
set -x # Show commands

CONFIG_FILE=$1
TREE_NAME=$2
NOSLEEP=$3

SCRIPT_PATH=$(readlink -f "$0")
MOZSEARCH_ROOT=$(dirname "$SCRIPT_PATH")
. $MOZSEARCH_ROOT/scripts/load-vars.sh $CONFIG_FILE $TREE_NAME

date

$MOZSEARCH_ROOT/scripts/find-repo-files.py $CONFIG_FILE $TREE_NAME
$MOZSEARCH_ROOT/scripts/mkdirs.sh

date

if [ "x$NOSLEEP" != "x1" ]
then
    sleep 1000
fi

date

$MOZSEARCH_ROOT/repos-setup/$TREE_NAME/build

date

$MOZSEARCH_ROOT/scripts/find-objdir-files.py
$MOZSEARCH_ROOT/scripts/objdir-mkdirs.sh

date

$MOZSEARCH_ROOT/scripts/js-analyze.sh

date

$MOZSEARCH_ROOT/scripts/idl-analyze.sh

date

$MOZSEARCH_ROOT/scripts/crossref.sh $CONFIG_FILE $TREE_NAME

date

$MOZSEARCH_ROOT/scripts/output.sh $CONFIG_FILE $TREE_NAME

date
